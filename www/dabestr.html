<!DOCTYPE html>
<html lang="en">
<head>
<title>QuickR App</title>
    
<script src="underscore-min.js"></script>    
<script src="jquery-1.10.2.min.js"></script>
<script src="opencpu-0.5.js"></script>
<script src="opencpu-server.js"></script>
<script src="src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>

<script>
$(function(){
  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/monokai");
  editor.getSession().setMode("ace/mode/r");
  editor.getSession().setUseWrapMode(true);
  editor.setFontSize("14px");

  //This app requires OpenCPU 1.0.1 or higher!
  
  function domarkdown(e){
    var req = ocpu.call("rmdtext", {
      text : editor.getSession().getValue()
    }, function(session){
console.log(session);
console.log(session.getFileURL("output.html"));
      $("iframe").attr('src', session.getFileURL("output.html"));     
    }).fail(function(text){
      alert("Error: " + req.responseText);
    });
  }

  //auto run after 2 seconds of no activity
  var update = _.debounce(domarkdown, 2000);
  
  //register event
  editor.on("change", update);
  
  //init on start
  domarkdown();  
});
</script>

<style type="text/css" media="screen">
 
#editor { 
  position: absolute;
  top: 0px;
  left: 0px;
  width: 40%;
  height: 100%;
}

iframe { 
  position: absolute;
  top: 0px;
  right: 0px;
  width: 60%;
  height: 100%;
  border: 0;
  margin: 0;
  z-index: 999999;
}

</style>
</head>
<body>


<div id="editor">

---
output:
  html_document:
    code_folding: hide
---

```{r block2, message=FALSE, fig.width=8, fig.height=5, dev='svg'}
library(dabestr)

library(dplyr)

set.seed(54321)

N = 40
c1 <- rnorm(N, mean = 100, sd = 25)
c2 <- rnorm(N, mean = 100, sd = 50)
g1 <- rnorm(N, mean = 120, sd = 25)
g2 <- rnorm(N, mean = 80, sd = 50)
g3 <- rnorm(N, mean = 100, sd = 12)
g4 <- rnorm(N, mean = 100, sd = 50)
gender <- c(rep('Male', N/2), rep('Female', N/2))
id <- 1: N


wide.data <- 
  tibble::tibble(
    Control1 = c1, Control2 = c2,
    Group1 = g1, Group2 = g2, Group3 = g3, Group4 = g4,
    Gender = gender, ID = id)


my.data   <- 
  wide.data %>%
  tidyr::gather(key = Group, value = Measurement, -ID, -Gender)

multi.two.group.paired <- 
  my.data %>%
  dabest(Group, Measurement, 
         idx = list(c("Control1", "Group1"), 
                    c("Control2", "Group2")),
         paired = TRUE, id.col = ID
         )

plot(multi.two.group.paired, color.column = Gender, slopegraph = TRUE)


</div>

<iframe src="about:blank"></iframe>

</body>
</html>
